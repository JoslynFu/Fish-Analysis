---
title: Examining Fishery Collapse
author: Joslyn Fu & Phoebe Goulden
output: github_document
---

```{r include = FALSE}
knitr::opts_chunk$set(message = FALSE)
```

This project examines current data (1950 to present) on overfishing and fishery collapse. We compare our results to findings in the Worm et al. (2006) paper which first reported on fishery collapse and its implications for biodiversity.


## The Database
We will use data from the [RAM Legacy Stock Assessment Database](https://doi.org/10.5281/zenodo.2542918)

```{r message = FALSE}
library("tidyverse")
library("readxl")
#install a helper package to download data first
#install.packages("ramlegacy")
library("ramlegacy")
```

```{r}
#download and unzip files
#overwrite = TRUE gets most updated version
download_ramlegacy(overwrite = TRUE)
```

```{r}
ram <- ramlegacy::load_ramlegacy(tables = c("timeseries", "stock", "area", "tsmetrics"))
```

```{r}
#join the 3 data tables we need
fish <- ram$timeseries %>%
  left_join(ram$stock, by = "stockid") %>%
  left_join(ram$tsmetrics, by = c("tsid" = "tsunique")) %>%
  left_join(ram$area, by = "areaid")
```

# Investigating the Decline of the North-Atlantic Cod

```{r}
#filter out only cod
cod <- fish %>% 
  filter(scientificname == "Gadus morhua") %>% select(-commonname)       %>% distinct() 

#total cod catch on the Canada East Coast in metric tons
canada_cod_MT <- cod %>% 
  filter(tsid == "TCbest-MT", region == "Canada East Coast") %>%
  group_by(tsyear, scientificname) %>% 
  summarise(total_catch = sum(tsvalue)) 

canada_cod_MT %>%
  ggplot(aes(tsyear, total_catch)) + geom_line(color = "blue") + theme_light() + labs(x = "Years", y = "Total Catch (MT)", title = "Trend in Cod Catch on the Canada East Coast")
```




Below is a similar figure from the Millenium Ecosystem Assessment Project using the RAM data. 

![](http://espm-157.carlboettiger.info/img/cod.jpg)

Our graph has a similar shape as the one above, reflecting the collapse of the Canada East Coast cod fishery around 1992. However, our values are much greater than in the orginal graph because we plotted total catch per year rather than total landings. The landing value is the number of fish brought back to the dock, whereas total catch is all fish caught. Total catch is a much larger value since many unwanted fish are thrown back before reaching shore. Additionally, we used data for the entire Canada East Coast, which includes 10 subregions.

```{r}
fish %>% filter(scientificname == "Gadus morhua", region == "Canada East Coast") %>% count(areaname)

fish %>% 
  filter(tsid == "TCbest-MT", region == "Canada East Coast") %>%
  group_by(tsyear, scientificname, areaid) %>% 
  summarise(total_catch = sum(tsvalue, na.rm=TRUE)) %>% 
  filter(scientificname == "Gadus morhua") %>%
  ggplot(aes(tsyear, total_catch, col = areaid)) + 
  geom_line()
```

**How does your graph compare to the one presented above?**

------


# Exercise 2: Group Assignment

## Stock Collapses

We seek to replicate the temporal trend in stock declines shown in [Worm et al 2006](http://doi.org/10.1126/science.1132294):

![](http://espm-157.carlboettiger.info/img/worm2006.jpg)
```{r}
fish %>% 
  filter(tsid == "TCbest-MT", region == "Canada East Coast") %>%
  group_by(tsyear, scientificname) %>% 
  summarise(total_catch = sum(tsvalue), total_catch < .10*cummax(tsvalue)) %>%
  filter(scientificname == "Gadus morhua") 

```

```{r}
#fish %>% filter(scientificname == "Gadus morhua") %>% count(areaname)
#fish %>% 
 # filter(tsid == "TCbest-MT", region == "Canada East Coast") %>%
  #group_by(tsyear, scientificname) %>% 
  #summarize(runmax()) %>%
 # filter(scientificname == "Gadus morhua") 
```

